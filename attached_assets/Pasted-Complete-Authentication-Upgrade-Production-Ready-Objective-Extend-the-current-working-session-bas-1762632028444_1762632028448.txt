Completeâ€¯Authenticationâ€¯Upgrade (Productionâ€‘Ready)
Objective:
Extend the current working sessionâ€‘based authentication system to include Googleâ€¯OAuthâ€¯Login, Emailâ€¯Verification, and Passwordâ€¯Reset, while retaining all existing security measures.
Maintain compatibility with sessionâ€‘based web login but also expose a lightweight JWT route for upcoming mobile integration (Hybrid Auth).

### ğŸ”§ Requirements & Implementation
Base foundation
Keep existing secure sessionâ€‘based auth for web.
Continue using bcrypt/argon2 for password hashing.
Retain HttpOnly + SameSite cookies, CSRF protection, and sessionâ€‘fixation prevention.
Addâ€¯Googleâ€¯OAuthâ€¯2.0
Use Googleâ€¯Identityâ€¯Services or Passportâ€‘Googleâ€‘OAuth20 (Node) / your framework equivalent.
Environmentâ€¯variables:
GOOGLE_CLIENT_ID=<from Googleâ€¯Cloudâ€¯Console>
GOOGLE_CLIENT_SECRET=<from Googleâ€¯Cloudâ€¯Console>
GOOGLE_CALLBACK_URL=https://toypetme.com/api/auth/google/callback
Routes:
/api/auth/googleâ€¯â†’â€¯redirect to Google.
/api/auth/google/callbackâ€¯â†’â€¯captureâ€¯tokenâ€¯+â€¯profileâ€¯+â€¯email, create or update account, start session, return to dashboard.
On success, new users automatically get profile populated with: name, email, joinDate.
Emailâ€¯Verificationâ€¯onâ€¯Signup
Use APIâ€‘based mail service (SendGridâ€¯/â€¯Resendâ€¯/â€¯MailerSend)â€¯â€“â€¯SMTP often blocked onâ€¯Replit.
Envâ€¯vars:
EMAIL_API_KEY=<key>
EMAIL_SENDER="ToyPetMe <noreply@toypetme.com>"
FRONTEND_URL=https://toypetme.com
Flow:
When user signs up â†’ mark verified:false â†’ send verificationâ€¯email withâ€¯tokenâ€¯link.
Endpoint /api/auth/verify?token=...â€¯â†’â€¯validatesâ€¯+â€¯switchesâ€¯verified:true.
Store shortâ€‘term token (expiresâ€¯inâ€¯15â€¯minâ€¯â€“â€¯24â€¯h).
Passwordâ€¯Resetâ€¯viaâ€¯Email
Endpointâ€¯/api/auth/request-reset â†’ verifies email, generatesâ€¯temporaryâ€¯token, sends link.
/api/auth/reset/:token â†’ verify + allow passwordâ€¯update.
Tokens stored hashed + short expiry (~15â€¯min).
Email template: branded â€œToyPetâ€¯Resetâ€¯Linkâ€.
JWTâ€¯Routeâ€¯(for mobile app later)
Keep sessions by default. Add:
/api/token issuing a shortâ€‘lived JWT from an active session (expiresInâ€¯15â€¯min), usingâ€¯JWT_SECRET.
/api/mobile/login â†’ (optional) loginâ€¯byâ€¯JWT for future mobile sync.
Profileâ€¯Enhancements
Extend userâ€¯schema:
json
Copy
{
  "username": "...",
  "email": "...",
  "verified": Boolean,
  "joinDate": Date,
  "authType": "local | google"
}
/api/user/profile returns verificationâ€¯statusâ€¯andâ€¯authType.
Securityâ€¯Improvement Tasks
Enforce HTTPS (redirectâ€¯middlewareâ€¯+â€¯HSTSâ€¯headersâ€¯+â€¯secureâ€¯cookies).
Add loginâ€¯rateâ€¯limitingâ€¯(5/minâ€¯perâ€¯IP).
Rotate secrets: SESSION_SECRET,â€¯JWT_SECRET,â€¯EMAIL_API_KEY,â€¯GOOGLE_CLIENT_SECRET.
Audit all sensitiveâ€¯cookies â†’â€¯HttpOnly,â€¯Secure,â€¯SameSite: Strict.
UXâ€¯Enhancements
Add â€œContinueâ€¯withâ€¯Googleâ€ button to loginâ€¯+â€¯signupâ€¯pages.
Add verification notice banner (â€œPleaseâ€¯verify your emailâ€).
Add â€œForgotâ€¯Password?â€ link to loginâ€¯form.
Confirmation modals on successâ€¯events.
Testing
âœ… Signupâ€¯â†’â€¯emailâ€¯verification.
âœ… Login/emailâ€¯&â€¯Googleâ€¯flows.
âœ… Verifyâ€¯thatâ€¯onlyâ€¯verifiedâ€¯accountsâ€¯canâ€¯accessâ€¯protectedâ€¯routes.
âœ… Passwordâ€¯resetâ€¯linkâ€¯andâ€¯tokenâ€¯expiry.
âœ… JWTâ€¯issuedâ€¯fromâ€¯sessionâ€¯for upcomingâ€¯mobile.
Deployment Check
All SSL certs + cookies secure.
Logs confirm â€œâœ… Emailâ€¯sentâ€, â€œâœ… Googleâ€¯OAuthâ€¯successâ€, â€œâœ… JWTâ€¯issuedâ€.
Error boundary returns proper JSON (noâ€¯stackâ€¯traceâ€¯leaks).
### ğŸ§° Environment Variables Summary
SESSION_SECRET=
JWT_SECRET=
GOOGLE_CLIENT_ID=
GOOGLE_CLIENT_SECRET=
GOOGLE_CALLBACK_URL=
EMAIL_API_KEY=
EMAIL_SENDER=
FRONTEND_URL=https://toypetme.com
### ğŸŒŸ Deliverables
Working Googleâ€¯OAuthâ€¯login + localâ€¯login.
Working emailâ€¯verificationâ€¯andâ€¯passwordâ€¯reset.
Optional JWT route for mobile.
Updated profileâ€¯schema.
Deployment script confirms success logs.
Report summarizing verification tests and API endpoints.
### ğŸš€ Priority Rationale
Feature	Importance	Result
Googleâ€¯OAuth	High (user onboarding & trust)	frictionless, familiar login
Emailâ€¯Verification & Reset	High (security & legitimacy)	professional app feel
JWT preview for mobile	Medium (futureâ€‘proofing)	crossâ€‘platform ready
Session security retention	Critical	4.5â€¯â­â€¯â†’â€¯5.0â€¯â­â€¯authâ€¯system